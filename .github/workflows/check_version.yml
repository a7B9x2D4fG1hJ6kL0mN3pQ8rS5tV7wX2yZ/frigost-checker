name: Check Frigost Version

on:
  workflow_dispatch:  # Seulement exÃ©cution manuelle via API/interface
  # Supprimez le schedule si prÃ©sent pour Ã©viter les exÃ©cutions automatiques

jobs:
  check-version:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Get current version
      id: get_version
      run: |
        # TÃ©lÃ©charge la version depuis votre URL
        VERSION_URL="https://raw.githubusercontent.com/a7B9x2D4fG1hJ6kL0mN3pQ8rS5tV7wX2yZ/vm-a7B9x2D4fG1h/refs/heads/main/v7wX2yZ_a7B9x2D4fG1hJ6kL0mN3pQ8rS5tV.dat"
        CURRENT_VERSION=$(curl -s $VERSION_URL)
        echo "current_version=$CURRENT_VERSION" >> $GITHUB_OUTPUT
        echo "Version rÃ©cupÃ©rÃ©e: $CURRENT_VERSION"
    
    - name: Compare versions
      id: compare
      run: |
        # RÃ©cupÃ¨re la version stockÃ©e localement (si existante)
        if [ -f "version.txt" ]; then
          LOCAL_VERSION=$(cat version.txt)
          echo "Version locale: $LOCAL_VERSION"
        else
          LOCAL_VERSION=""
          echo "Aucune version locale trouvÃ©e"
        fi
        
        CURRENT_VERSION="${{ steps.get_version.outputs.current_version }}"
        
        # Compare les versions
        if [ "$LOCAL_VERSION" = "$CURRENT_VERSION" ]; then
          echo "Les versions sont identiques"
          echo "has_changed=false" >> $GITHUB_OUTPUT
        else
          echo "NOUVELLE VERSION DÃ‰TECTÃ‰E !"
          echo "Ancienne: $LOCAL_VERSION"
          echo "Nouvelle: $CURRENT_VERSION"
          echo "has_changed=true" >> $GITHUB_OUTPUT
          
          # Met Ã  jour le fichier local
          echo "$CURRENT_VERSION" > version.txt
        fi
    
    - name: Send notification if changed
      if: steps.compare.outputs.has_changed == 'true'
      run: |
        # Envoie une notification (optionnel)
        echo "ðŸ”” Nouvelle version disponible !"
        # Vous pouvez ajouter une notification Discord/Email ici
        
    - name: Commit changes if version changed
      if: steps.compare.outputs.has_changed == 'true'
      run: |
        # Configure Git
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # Commit et push si la version a changÃ©
        git add version.txt
        git commit -m "Update Frigost version to ${{ steps.get_version.outputs.current_version }}"
        git push
